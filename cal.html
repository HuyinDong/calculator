<html>

<head>
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="./bootstrap.css">
    <style>
        .style1 {
            background-color: red;
        }

        .btn {
            width: 100%;
            /* set to 100% */
            height: 100%;
            border: solid #cccccc 1px;
        }
    </style>
</head>


<body ng-app='cal' ng-controller='calCtrl'>
    <div class="jumbotron">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <table class="table">

                        <thead>
                            <tr>
                                <thead>
                                    <h4>Calculator</h4></thead>
                            </tr>
                        </thead>

                        <tr>

                            <input type="text" class="form-control" style="width:322px; height:40px; float:left;" ng-model='result' disabled="true">

                        </tr>
                        <tr ng-repeat="num in nums track by $index">
                            <td ng-repeat="n in num track by $index" style="width:80px; height:80px; float:left;" ng-mouseover="hoverIn($parent.$index,$index)" ng-mouseleave="hoverOut($parent.$index,$index)" ng-click="add(n)"><input id="{{$parent.$index}}_{{$index}}" class="btn" type="button" value="{{n.value}}"></td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-4">
                    <table class="table table-bordered">

                        <thead>
                            <tr>
                                <thead>
                                    <h4>History</h4></thead>
                            </tr>
                        </thead>

                        <tr ng-repeat="his in history track by $index">
                            <td>{{$index+1}}</td>
                            <td>{{his}}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="./jquery.min.js"></script>
    <script src="./bootstrap.min.js"></script>
    <script src="./angular.min.js"></script>
    <script>
        /*
         *  Stack
         */
        var Stack = function() {
            this.list = [];
        };
        Stack.prototype.push = function(obj) {
            this.list.push(obj);
        };
        Stack.prototype.pop = function() {
            var temp = this.list[this.list.length - 1];
            this.list.splice(this.list.length - 1, 1);
            return temp;
        };
        Stack.prototype.peek = function() {
            var temp = this.list[this.list.length - 1];
            return temp;
        };
        Stack.prototype.isEmpty = function() {
            return this.list.length == 0;
        };
        Stack.prototype.size = function() {
            return this.list.length;
        };
    </script>
    <script>
        var cal = angular.module('cal', []);
        cal.controller('calCtrl', function($scope) {
            $scope.history = [];
            $scope.result = "";
            $scope.nums = [
                [{
                        value: 'c',
                        type: 'clear'
                    },
                    {
                        value: 'ce',
                        type: 'clear'
                    },
                    {
                        value: '=',
                        type: 'equal'
                    },
                    {
                        value: '',
                        type: 'reserved'
                    }
                ],
                [{
                        value: 7,
                        type: 'number'
                    },
                    {
                        value: 8,
                        type: 'number'
                    },
                    {
                        value: 9,
                        type: 'number'
                    },
                    {
                        value: '/',
                        type: 'operator',
                        precedence: 3

                    }
                ],
                [{
                        value: 4,
                        type: 'number'
                    },
                    {
                        value: 5,
                        type: 'number'
                    },
                    {
                        value: 6,
                        type: 'number'
                    },
                    {
                        value: '*',
                        type: 'operator',
                        precedence: 3

                    }
                ],
                [{
                        value: 1,
                        type: 'number'
                    },
                    {
                        value: 2,
                        type: 'number'
                    },
                    {
                        value: 3,
                        type: 'number'
                    },
                    {
                        value: '-',
                        type: 'operator',
                        precedence: 2
                    }
                ],
                [{
                        value: 0,
                        type: 'number'
                    },

                    {
                        value: 9,
                        type: 'number'
                    },
                    {
                        value: '.',
                        type: 'number'
                    },
                    {
                        value: '+',
                        type: 'operator',
                        precedence: 2
                    }
                ],
                [{
                        value: '(',
                        type: 'pos_paren',
                        precedence: ""
                    },
                    {
                        value: ')',
                        type: 'neg_paren',
                        precedence: ""
                    },
                    {
                        value: '',
                        type: ''
                    },
                    {
                        value: '^',
                        type: 'operator',
                        precedence: 4
                    },
                ]
            ];
            $scope.hoverIn = function(col, row) {
                $("#" + col + "_" + row).addClass("style1");
            };

            $scope.hoverOut = function(col, row) {
                $("#" + col + "_" + row).removeClass("style1");
            };
            var previousType = "";
            var arr = [];
            var temp = "";

            $scope.add = function(n) {
                if (n.value == '=') {
                    $scope.result += '=';
                    var res = cal(arr);
                    $scope.result += res.value;
                } else {
                    arr.push(n);
                    $scope.result += n.value;
                }

                /*
                  if (previousType == "operator" && n.type == "operator") {
                      $scope.result = $scope.result.substr(0, $scope.result.length - 1);
                  }
                  if (n.value == "ce") {
                      $scope.result = "";
                      arr = [];
                      previousType = ""
                      temp = "";
                  } else if (n.value == "c") {
                      $scope.result = "";
                      $scope.history = [];
                      arr = [];
                      previousType = ""
                      temp = "";
                  } else if (n.type != "equal") {
                      $scope.result += n.value;
                      if (n.type == "operator") {
                          if (previousType == "operator") {
                              arr.splice(length - 1, 1, n);
                          } else {
                              arr.push({
                                  value: temp,
                                  type: "number"
                              });
                              arr.push(n);
                              temp = "";
                          }
                      } else {
                          temp += n.value;
                      }
                      previousType = n.type;
                  } else {
                      if (previousType == "operator") {
                          $scope.result = "Wrong format";
                      } else {
                          arr.push({
                              value: temp,
                              type: "number"
                          });
                          $scope.result += n.value;


                      }
                      $scope.history.push($scope.result);
                      //arr = [];
                      previousType = "";
                      temp = "";
                      $scope.result = "";
                      previousType = n.type;

                  }
                  */
            };


            function shunting_yard(test) {
                var stack = new Stack();
                var result = [];
                for (var i = 0; i < test.length; i++) {
                    var ele = test[i];
                    console.log(ele);
                    if (ele.type == 'number') {
                        result.push(ele);
                    } else if (ele.type == 'operator') {
                        if (!stack.isEmpty()) {

                            var top = stack.peek();
                            if (top.type != 'pos_paren') {

                                if (ele.precedence <= stack.peek().precedence) {
                                    result.push(stack.pop());
                                }
                                stack.push(ele);
                            } else {
                                stack.push(ele);
                            }
                        } else {
                            stack.push(ele);
                        }
                    } else if (ele.type == 'pos_paren') {
                        stack.push(ele);
                    } else if (ele.type == 'neg_paren') {
                        while (stack.peek().type != 'pos_paren') {
                            result.push(stack.pop());
                        }
                        stack.pop();
                    }
                }

                while (!stack.isEmpty()) {
                    result.push(stack.pop());
                }

                return result;
            };
            //3 + 4 * 2 / ( 1 - 5 ) ^ 2 ^ 3
            var test = [{
                    value: 1,
                    type: 'number'
                },
                {
                    value: '+',
                    type: 'operator',
                    precedence: 2
                },

                {
                    value: '(',
                    type: 'pos_paren',
                    precedence: ''
                },
                {
                    value: 2,
                    type: 'number'
                },
                {
                    value: '*',
                    type: 'operator',
                    precedence: 3
                },
                {
                    value: '(',
                    type: 'pos_paren',
                    precedence: ''
                },

                {
                    value: 2,
                    type: 'number'
                },
                {
                    value: '+',
                    type: 'operator',
                    precedence: 2
                },
                {
                    value: 2,
                    type: 'number'
                },
                {
                    value: ')',
                    type: 'neg_paren',
                    precedence: ''
                },
                {
                    value: ')',
                    type: 'neg_paren',
                    precedence: ''
                },
                {
                    value: '*',
                    type: 'operator',
                    precedence: 3
                },
                {
                    value: 3,
                    type: 'number'
                },
                {
                    value: '+',
                    type: 'operator',
                    precedence: 2
                },
                {
                    value: 5,
                    type: 'number'
                }
            ];
            console.log(test.length);
            var t = cal(test);
            console.log(t);

            function cal(arr) {
                console.log('input', arr);
                var result = shunting_yard(arr);
                var stack = new Stack();
                for (var i = 0; i < result.length; i++) {
                    console.log(result[i]);
                    if (result[i].type == 'number') {
                        stack.push(result[i]);
                    } else {
                        var value;
                        var previous;
                        if (result[i].value == '+') {
                            value = stack.pop().value + stack.pop().value;
                        } else if (result[i].value == '-') {
                            previous = stack.pop().value;
                            value = stack.pop().value - previous;
                        } else if (result[i].value == '*') {
                            value = stack.pop().value * stack.pop().value;
                        } else if (result[i].value == '/') {
                            previous = stack.pop().value;
                            value = stack.pop().value / previous;
                        }
                        console.log(value);
                        var temp = {
                            value: value,
                            type: 'number'
                        }
                        stack.push(temp);
                    }
                }
                return stack.pop();
            }


            $(function() {

                //$("#0_2").parent().attr("colspan", 2);

                $("#0_3").attr("disabled", true);
                $("#5_2").attr("disabled", true);


            });

        });
    </script>
</body>

</html>
